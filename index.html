<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>
        
        沧浪</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="人的一切痛苦，本质上都是对自己无能的愤怒">
<meta property="og:type" content="website">
<meta property="og:title" content="沧浪">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="沧浪">
<meta property="og:description" content="人的一切痛苦，本质上都是对自己无能的愤怒">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="沧浪">
<meta name="twitter:description" content="人的一切痛苦，本质上都是对自己无能的愤怒">
    
    <link rel="alternative" href="/atom.xml" title="沧浪" type="application/atom+xml">
    
    
    <link rel="icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?50109d35346523556446b8ca2ab69d72";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="https://avatars0.githubusercontent.com/u/6065488?v=3&amp;u=1304a29788f86d10615bb1ae6c9ded613352f363&amp;s=140">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">sinoon</a></h1>
		</hgroup>

		
		<p class="header-subtitle">沧浪之水清兮，可以濯我衣；沧浪之水浊兮，可以濯我足。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="http://github.com/sinoon" title="github">github</a>
					        
								<a class="mail" target="_blank" href="mailto:sinoon1218@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/JavaScript-对象-复制/" style="font-size: 10px;">JavaScript 对象 复制</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/node-redis-msgpack-messagepack/" style="font-size: 10px;">node redis msgpack messagepack</a> <a href="/tags/webhook-github-nodejs/" style="font-size: 10px;">webhook github nodejs</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">站在这里，看着远方。风大浪大，风流飘荡。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">sinoon</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://avatars0.githubusercontent.com/u/6065488?v=3&amp;u=1304a29788f86d10615bb1ae6c9ded613352f363&amp;s=140">
				<hgroup>
				  <h1 class="header-author">sinoon</h1>
				</hgroup>
			</div>
			
			<p class="header-subtitle">沧浪之水清兮，可以濯我衣；沧浪之水浊兮，可以濯我足。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com/sinoon" title="github">github</a>
			        
						<a class="mail" target="_blank" href="mailto:sinoon1218@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-github-webhook服务签名算法-nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/08/24/github-webhook服务签名算法-nodejs/" class="article-date">
  	<time datetime="2015-08-24T12:16:27.000Z" itemprop="datePublished">2015-08-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/24/github-webhook服务签名算法-nodejs/">github - webhook服务签名算法 - nodejs</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言">前言</h2><p><code>webhook</code>是<code>github</code>推出的一项免费服务，当仓库出现变动（<code>push</code>、<code>issue</code>变动等）的时候，会向仓库设置的指定地址，发送一个post请求，请求包括非常多的内容。</p>
<p>我自己开发的<code>weichat.io</code>部署在<code>DigitalOcean</code>上面，每次更新代码都要远程登录到服务器上手动更新代码。</p>
<p>我初中(2004-2007)的一个数学老师，曾经说过，聪明的人都是很懒的，当时用来举例如何用最简单的方式解决题目。近几年也有看到文章讲过类似的话。正因为懒，所以才会有这么多工具出现。</p>
<p>说了几句题外话，言归正传。一开始我找的方式是<code>git hook</code>，指定某个行为之后执行某个脚本，脚本就是<code>shell</code>。在网上搜了很多文章，觉得还是不够优雅。</p>
<p>无意中看到<code>github</code>提供的<code>webhook</code>服务，设置方便，还可以配置签名。</p>
<h2 id="设置">设置</h2><p>设置如下：</p>
<ol>
<li><p>进入仓库设置页面<br><img src="http://i1.tietuku.com/087c5f14a4c8ff9c.png" alt="进入仓库设置页面"></p>
</li>
<li><p>进入<code>Webhooks &amp; services</code>设置选项<img src="http://i1.tietuku.com/7a2e449b4ab7f585.png" alt="进入`Webhooks &amp; services`设置选项"></p>
</li>
<li><p>设置页面<img src="http://i1.tietuku.com/96de7557404d53a8.jpg" alt="设置页面"></p>
</li>
<li>设置内容<img src="http://i3.tietuku.com/2822d2470ec9a8f4.jpg" alt="设置内容"><ul>
<li>第一个设置是<code>github</code>将会发信息的地址，请求类型是<code>post</code>，内容很多，包括此次提交的信息，提交的人等信息。</li>
<li>第二个是发送请求的<code>Content type</code>，可以是<code>application/json</code>或者<code>application/x-www-form-urlencoded</code>，也就是一个过来的是<code>json</code>一个是<code>form</code>形式，看自己选择。</li>
<li>第三个<code>Secret</code>，用来加密匹配的，在发送请求的头里面有一个字段<code>x-hub-signature</code>里面是对请求的<code>body</code>计算<code>sha1</code>的值。</li>
<li>注意：<code>Secret</code>计算的<code>body</code>的值，是以<code>buffer</code>(对于nodejs来说，也就是没有<code>decode</code>过请求的内容)值来做的。同时<code>x-hub-signature</code>字段在<code>headers</code>里面是有大小写的，只不过在<code>express</code>里面经过中间件之后全部变成小写了。</li>
</ul>
</li>
</ol>
<h2 id="示例代码">示例代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express，直接给出req和res。</span></span><br><span class="line"><span class="comment">// 可以放在自己的controller里面，或者直接写在路由里</span></span><br><span class="line"><span class="comment">// 直接写在路由里:</span></span><br><span class="line"><span class="comment">// app.post('/update',function(req,res)&#123;</span></span><br><span class="line"><span class="comment">//     // 下面函数的内容</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> shell = <span class="built_in">require</span>(<span class="string">'shelljs'</span>);</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"> req,res,next </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(req);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// abcdefg 这个是在github那里设置的Secret</span></span><br><span class="line">	<span class="keyword">var</span> hmac = crypto.createHmac(<span class="string">'sha1'</span>,<span class="string">'abcdefg'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注意：这里已经被express中间件转化为对象了，需要先转换成字符串再恢复为一个Buffer对象，然后进行的算法才是正确的</span></span><br><span class="line">	hmac.update(<span class="keyword">new</span> Buffer(<span class="built_in">JSON</span>.stringify(req.body)));</span><br><span class="line">	<span class="built_in">console</span>.log(req.body);</span><br><span class="line">	<span class="keyword">var</span> signature = <span class="string">'sha1='</span> + hmac.digest(<span class="string">'hex'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里已经全都变成小写了，实际上首字符都是大写的</span></span><br><span class="line">	<span class="keyword">var</span> _signature = req.headers[<span class="string">'x-hub-signature'</span>];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(signature);</span><br><span class="line">	<span class="built_in">console</span>.log(_signature);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(req.headers[<span class="string">'x-hub-signature'</span>] != signature)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'匹配失败'</span>);</span><br><span class="line">		<span class="keyword">return</span> res.end()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// github会记录每次推送的结果，就像访问一个页面一样，如果服务器成功接受建议返回一点内容，不要404</span></span><br><span class="line">	res.end(<span class="string">'ok'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*  下面只是实例代码，基本更新流程就是这样</span><br><span class="line">	*   如果使用多个分支的话，需要自行判断更新的分支</span><br><span class="line">	*   不然开发分支的push会造成生产环境分支也更新重启</span><br><span class="line">	*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印当前目录</span></span><br><span class="line">	shell.pwd();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// fetch + merge</span></span><br><span class="line">	shell.exec(<span class="string">'git pull'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 重启pm2</span></span><br><span class="line">	shell.exec(<span class="string">'pm2 restart all'</span>)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h2 id="webhook记录每次推送">webhook记录每次推送</h2><ul>
<li><p>推送结果显示<img src="http://i3.tietuku.com/74dec150aba40466.jpg" alt="推送结果显示"></p>
</li>
<li><p>推送失败的显示<img src="http://i3.tietuku.com/4dc079a84d7bc4b5.png" alt="推送失败显示"></p>
</li>
</ul>
<h2 id="webhook服务推送请求的body样子">webhook服务推送请求的body样子</h2><p>以下是我测试时,<code>webhook</code>发送过来的一个请求的<code>body</code>的内容。</p>
<ul>
<li>我这里更新了dev分支</li>
<li>我的用户名是<code>sinoon</code></li>
<li><code>https://github.com/sinoon/weichat.io</code>是仓库地址</li>
<li>熟悉<code>git</code>的人，可以从请求里面看出很多东西</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">&#123; ref: 'refs/heads/dev',</span><br><span class="line">  before: '08babdb11f190bdff563c23ad9643385e18a3b2b',</span><br><span class="line">  after: '2ea1bf7b521c652bab1e0a8aee3751d3bc7688bc',</span><br><span class="line">  created: false,</span><br><span class="line">  deleted: false,</span><br><span class="line">  forced: false,</span><br><span class="line">  base_ref: null,</span><br><span class="line">  compare: 'https://github.com/sinoon/weichat.io/compare/08babdb11f19...2ea1bf7b521c',</span><br><span class="line">  commits:</span><br><span class="line">   [ &#123; id: '2ea1bf7b521c652bab1e0a8aee3751d3bc7688bc',</span><br><span class="line">       distinct: true,</span><br><span class="line">       message: '* 测试webhook签名',</span><br><span class="line">       timestamp: '2015-08-23T18:49:26+08:00',</span><br><span class="line">       url: 'https://github.com/sinoon/weichat.io/commit/2ea1bf7b521c652bab1e0a8aee3751d3bc7688bc',</span><br><span class="line">       author: [Object],</span><br><span class="line">       committer: [Object],</span><br><span class="line">       added: [],</span><br><span class="line">       removed: [],</span><br><span class="line">       modified: [Object] &#125; ],</span><br><span class="line">  head_commit:</span><br><span class="line">   &#123; id: '2ea1bf7b521c652bab1e0a8aee3751d3bc7688bc',</span><br><span class="line">     distinct: true,</span><br><span class="line">     message: '* 测试webhook签名',</span><br><span class="line">     timestamp: '2015-08-23T18:49:26+08:00',</span><br><span class="line">     url: 'https://github.com/sinoon/weichat.io/commit/2ea1bf7b521c652bab1e0a8aee3751d3bc7688bc',</span><br><span class="line">     author:</span><br><span class="line">      &#123; name: 'sinoon',</span><br><span class="line">        email: 'sinoon1218@gmail.com',</span><br><span class="line">        username: 'sinoon' &#125;,</span><br><span class="line">     committer:</span><br><span class="line">      &#123; name: 'sinoon',</span><br><span class="line">        email: 'sinoon1218@gmail.com',</span><br><span class="line">        username: 'sinoon' &#125;,</span><br><span class="line">     added: [],</span><br><span class="line">     removed: [],</span><br><span class="line">     modified: [ 'package.json' ] &#125;,</span><br><span class="line">  repository:</span><br><span class="line">   &#123; id: 41168931,</span><br><span class="line">     name: 'weichat.io',</span><br><span class="line">     full_name: 'sinoon/weichat.io',</span><br><span class="line">     owner: &#123; name: 'sinoon', email: 'sinoon1218@gmail.com' &#125;,</span><br><span class="line">     private: false,</span><br><span class="line">     html_url: 'https://github.com/sinoon/weichat.io',</span><br><span class="line">     description: '',</span><br><span class="line">     fork: false,</span><br><span class="line">     url: 'https://github.com/sinoon/weichat.io',</span><br><span class="line">     forks_url: 'https://api.github.com/repos/sinoon/weichat.io/forks',</span><br><span class="line">     keys_url: 'https://api.github.com/repos/sinoon/weichat.io/keys&#123;/key_id&#125;',</span><br><span class="line">     collaborators_url: 'https://api.github.com/repos/sinoon/weichat.io/collaborators&#123;/collaborator&#125;',</span><br><span class="line">     teams_url: 'https://api.github.com/repos/sinoon/weichat.io/teams',</span><br><span class="line">     hooks_url: 'https://api.github.com/repos/sinoon/weichat.io/hooks',</span><br><span class="line">     issue_events_url: 'https://api.github.com/repos/sinoon/weichat.io/issues/events&#123;/number&#125;',</span><br><span class="line">     events_url: 'https://api.github.com/repos/sinoon/weichat.io/events',</span><br><span class="line">     assignees_url: 'https://api.github.com/repos/sinoon/weichat.io/assignees&#123;/user&#125;',</span><br><span class="line">     branches_url: 'https://api.github.com/repos/sinoon/weichat.io/branches&#123;/branch&#125;',</span><br><span class="line">     tags_url: 'https://api.github.com/repos/sinoon/weichat.io/tags',</span><br><span class="line">     blobs_url: 'https://api.github.com/repos/sinoon/weichat.io/git/blobs&#123;/sha&#125;',</span><br><span class="line">     git_tags_url: 'https://api.github.com/repos/sinoon/weichat.io/git/tags&#123;/sha&#125;',</span><br><span class="line">     git_refs_url: 'https://api.github.com/repos/sinoon/weichat.io/git/refs&#123;/sha&#125;',</span><br><span class="line">     trees_url: 'https://api.github.com/repos/sinoon/weichat.io/git/trees&#123;/sha&#125;',</span><br><span class="line">     statuses_url: 'https://api.github.com/repos/sinoon/weichat.io/statuses/&#123;sha&#125;',</span><br><span class="line">     languages_url: 'https://api.github.com/repos/sinoon/weichat.io/languages',</span><br><span class="line">     stargazers_url: 'https://api.github.com/repos/sinoon/weichat.io/stargazers',</span><br><span class="line">     contributors_url: 'https://api.github.com/repos/sinoon/weichat.io/contributors',</span><br><span class="line">     subscribers_url: 'https://api.github.com/repos/sinoon/weichat.io/subscribers',</span><br><span class="line">     subscription_url: 'https://api.github.com/repos/sinoon/weichat.io/subscription',</span><br><span class="line">     commits_url: 'https://api.github.com/repos/sinoon/weichat.io/commits&#123;/sha&#125;',</span><br><span class="line">     git_commits_url: 'https://api.github.com/repos/sinoon/weichat.io/git/commits&#123;/sha&#125;',</span><br><span class="line">     comments_url: 'https://api.github.com/repos/sinoon/weichat.io/comments&#123;/number&#125;',</span><br><span class="line">     issue_comment_url: 'https://api.github.com/repos/sinoon/weichat.io/issues/comments&#123;/number&#125;',</span><br><span class="line">     contents_url: 'https://api.github.com/repos/sinoon/weichat.io/contents/&#123;+path&#125;',</span><br><span class="line">     compare_url: 'https://api.github.com/repos/sinoon/weichat.io/compare/&#123;base&#125;...&#123;head&#125;',</span><br><span class="line">     merges_url: 'https://api.github.com/repos/sinoon/weichat.io/merges',</span><br><span class="line">     archive_url: 'https://api.github.com/repos/sinoon/weichat.io/&#123;archive_format&#125;&#123;/ref&#125;',</span><br><span class="line">     downloads_url: 'https://api.github.com/repos/sinoon/weichat.io/downloads',</span><br><span class="line">     issues_url: 'https://api.github.com/repos/sinoon/weichat.io/issues&#123;/number&#125;',</span><br><span class="line">     pulls_url: 'https://api.github.com/repos/sinoon/weichat.io/pulls&#123;/number&#125;',</span><br><span class="line">     milestones_url: 'https://api.github.com/repos/sinoon/weichat.io/milestones&#123;/number&#125;',</span><br><span class="line">     notifications_url: 'https://api.github.com/repos/sinoon/weichat.io/notifications&#123;?since,all,participating&#125;',</span><br><span class="line">     labels_url: 'https://api.github.com/repos/sinoon/weichat.io/labels&#123;/name&#125;',</span><br><span class="line">     releases_url: 'https://api.github.com/repos/sinoon/weichat.io/releases&#123;/id&#125;',</span><br><span class="line">     created_at: 1440178744,</span><br><span class="line">     updated_at: '2015-08-21T18:01:19Z',</span><br><span class="line">     pushed_at: 1440326986,</span><br><span class="line">     git_url: 'git://github.com/sinoon/weichat.io.git',</span><br><span class="line">     ssh_url: 'git@github.com:sinoon/weichat.io.git',</span><br><span class="line">     clone_url: 'https://github.com/sinoon/weichat.io.git',</span><br><span class="line">     svn_url: 'https://github.com/sinoon/weichat.io',</span><br><span class="line">     homepage: 'http://weichat.io',</span><br><span class="line">     size: 0,</span><br><span class="line">     stargazers_count: 0,</span><br><span class="line">     watchers_count: 0,</span><br><span class="line">     language: 'JavaScript',</span><br><span class="line">     has_issues: true,</span><br><span class="line">     has_downloads: true,</span><br><span class="line">     has_wiki: true,</span><br><span class="line">     has_pages: false,</span><br><span class="line">     forks_count: 0,</span><br><span class="line">     mirror_url: null,</span><br><span class="line">     open_issues_count: 0,</span><br><span class="line">     forks: 0,</span><br><span class="line">     open_issues: 0,</span><br><span class="line">     watchers: 0,</span><br><span class="line">     default_branch: 'dev',</span><br><span class="line">     stargazers: 0,</span><br><span class="line">     master_branch: 'dev' &#125;,</span><br><span class="line">  pusher: &#123; name: 'sinoon', email: 'sinoon1218@gmail.com' &#125;,</span><br><span class="line">  sender:</span><br><span class="line">   &#123; login: 'sinoon',</span><br><span class="line">     id: 6065488,</span><br><span class="line">     avatar_url: 'https://avatars.githubusercontent.com/u/6065488?v=3',</span><br><span class="line">     gravatar_id: '',</span><br><span class="line">     url: 'https://api.github.com/users/sinoon',</span><br><span class="line">     html_url: 'https://github.com/sinoon',</span><br><span class="line">     followers_url: 'https://api.github.com/users/sinoon/followers',</span><br><span class="line">     following_url: 'https://api.github.com/users/sinoon/following&#123;/other_user&#125;',</span><br><span class="line">     gists_url: 'https://api.github.com/users/sinoon/gists&#123;/gist_id&#125;',</span><br><span class="line">     starred_url: 'https://api.github.com/users/sinoon/starred&#123;/owner&#125;&#123;/repo&#125;',</span><br><span class="line">     subscriptions_url: 'https://api.github.com/users/sinoon/subscriptions',</span><br><span class="line">     organizations_url: 'https://api.github.com/users/sinoon/orgs',</span><br><span class="line">     repos_url: 'https://api.github.com/users/sinoon/repos',</span><br><span class="line">     events_url: 'https://api.github.com/users/sinoon/events&#123;/privacy&#125;',</span><br><span class="line">     received_events_url: 'https://api.github.com/users/sinoon/received_events',</span><br><span class="line">     type: 'User',</span><br><span class="line">     site_admin: false &#125; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="结束语">结束语</h2><p>我曾调试<code>webhook</code>签名好久，每次都要先推送到远程服务器，然后再手动创建一次推送让<code>webhook</code>发送推送。</p>
<p>写这篇文章希望看到的人可以直接知道该签名算法以及<code>webhook</code>推送的<code>body</code>内容，便于大家开发。</p>
<p>其实只要记住是<code>String</code>类型的<code>Buffer</code>，以及<code>express</code>下都会是小写。</p>
<p>祝大家工作顺利，事事如意。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webhook-github-nodejs/">webhook github nodejs</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-Nodejs使用MsgPack存入到Redis的一个坑" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/04/01/Nodejs使用MsgPack存入到Redis的一个坑/" class="article-date">
  	<time datetime="2015-04-01T13:44:06.000Z" itemprop="datePublished">2015-04-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/01/Nodejs使用MsgPack存入到Redis的一个坑/">Nodejs使用MsgPack存入到Redis的一个坑</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在做的项目中，需要用到往Redis中存入一些信息。之前都是用 <code>JSON.stringify()</code> 成字符串，再保存到Redis中，同时需要在Redis脚本中需要使用 <code>cjson.decode()</code> 命令，变成lua的table，再进行一些操作。<br>既然这样，那就不如用 <code>MessagePack</code> <a href="http://msgpack.org" target="_blank" rel="external">官网</a>。<br><code>MessagePack</code> 简称 <code>msgpack</code> ，按照官网上所说，它 <code>like</code> Json，但是 <code>fast</code> and <code>small</code> ，我一看，矮油，这个很好啊，正好我需要多次调用json对象的压缩和解析。</p>
<p>先安装它在node上的包 <code>msgpack5</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install msgpack5 --save</span><br></pre></td></tr></table></figure></p>
<p>我在这里加上 <code>--save</code> ，这样在下载到本地时候，在当前目录下的 <code>package.json</code> 会自动添加依赖，带版本号滴呦，很省心有木有~</p>
<p>在用到 <code>msgpack</code> 的js文件中引入即可。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msgpack = <span class="built_in">require</span>(<span class="string">'msgpack5'</span>)();</span><br></pre></td></tr></table></figure></p>
<p>注意，这里有个小坑，就是引入的时候，必须当做函数运行一下，也就是后面加上那对括号。不然使用的时候，是代码不是调用。</p>
<p>普通的使用方式可以和 <code>JSON.stringify()</code> &amp;&amp; <code>JSON.parse()</code> 一样。<br>像这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    a : <span class="number">1</span>,</span><br><span class="line">    b : <span class="number">2</span>,</span><br><span class="line">    c : c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = msgpack.encode(a); <span class="comment">// 压缩</span></span><br><span class="line"><span class="keyword">var</span> c = msgpack.decode(b); <span class="comment">// 解压缩</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( c === a);</span><br></pre></td></tr></table></figure></p>
<p>注意，使用 <code>msgpack.encode</code> 之后返回的是一个 <code>Buffer</code> 对象或者是 <code>bl</code> 实例，这个 <code>bl</code> 全名 <code>BufferList</code> 是一个操作 <code>Buffer</code> 的利器。所以，其这一点和 <code>JSON.stringify()</code> 不同，需要注意。</p>
<p>node连接redis有一个官方的包，安装引入即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redis --save</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> redis = <span class="built_in">require</span>(<span class="string">'redis'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = redis.createClient(); <span class="comment">// 什么都不行默认是 6379端口，127.0.0.1</span></span><br></pre></td></tr></table></figure>
<p>好了，到此为止，准备活动已经好，坑也已经挖好了，下面开始跳坑。代码伺候。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    a : <span class="number">1</span>,</span><br><span class="line">    b : <span class="number">2</span>,</span><br><span class="line">    c : c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = msgpack.encode(a); <span class="comment">// 压缩</span></span><br><span class="line"><span class="keyword">var</span> c = msgpack.decode(b); <span class="comment">// 解压缩</span></span><br><span class="line"></span><br><span class="line">client.set(<span class="string">'test'</span>,b);</span><br><span class="line"><span class="keyword">var</span> d = client.get(<span class="string">'test'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( b === d); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>运行这段代码，发现用 <code>msgpack.encode()</code> 之后的 <code>a</code> ，存入Redis中之后，再取出来就不是它了！你可以运行这段代码试试。</p>
<p>然后我又测试了不存入Redis的情况，发现很正常，就是存入Redis中，就出错。</p>
<p>打印存入之前和取出的 <code>Buffer</code> 对象，发现对象前面后面都多了一些不同的东西，只有中间是一样的。</p>
<p>百思不得其解，没有办法，只好先换回JSON方式来处理数据。</p>
<p>直到第二天，无意中看这个连接Redis的包时，看到这么一句话：</p>
<blockquote>
<p><strong>return_buffers</strong>: defaults to false. If set to true, then all replies will be sent to callbacks as node Buffer objects instead of JavaScript Strings.</p>
</blockquote>
<p>和这么一句</p>
<blockquote>
<p><strong>detect_buffers</strong>: default to false. If set to true, then replies will be sent to callbacks as node Buffer objects if any of the input arguments to the original command were Buffer objects. This option lets you switch between Buffers and Strings on a per-command basis, whereas return_buffers applies to every command on a client.</p>
</blockquote>
<p>也就是说，在这个包中，有两个设置项，默认都是 <code>false</code> 。如果修改为 <code>true</code> 的话，第一个设置（<code>return_buffers</code>）所有作为 <code>callback</code> 的返回都会是一个 <code>Buffer</code> 对象，而不再是 <code>JavaScript String</code> 。</p>
<p>也就是说，只要我们在 <code>redis.createClient({return_buffers:true})</code> 加上里面个选项或者 <code>detect_buffers:true</code> ， 传入和取出的数据都会是 <code>Buffer</code> 类型了。</p>
<p>使用 <code>MsgPack</code> 压缩或者 类似的 <code>Buffer</code> 终于不再有问题了。</p>
<p>尼玛。。。瞬间舒爽了，终于发现问题了。</p>
<p>实际上，不光是所有的 <code>replise</code> 都会是一个 <code>Buffer</code>，再向Redis里面存储数据的时候，也会先转换成一个 <code>String</code> ， 这就相当于直接把用 <code>msgpack</code> 压缩后的 <code>Buffer</code> 强制转换回 <code>String</code> ，而不经过 <code>msgpack</code> 自身的算法来解压。</p>
<p>第二个设置比较灵活，它会根据是否是一个 <code>Buffer</code> 来选择是否返回一个 <code>Buffer</code> 对象。</p>
<p>至此，困扰我两天的问题终于解决了。</p>
<p>恩，很高兴，来来，一起同饮三百杯~~！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-redis-msgpack-messagepack/">node redis msgpack messagepack</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-JavaScript引用对象的复制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/03/28/JavaScript引用对象的复制/" class="article-date">
  	<time datetime="2015-03-28T01:06:04.000Z" itemprop="datePublished">2015-03-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/28/JavaScript引用对象的复制/">JavaScript引用对象的复制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JavaScript引用对象复制">JavaScript引用对象复制</h1><p>JavaScript有6种数据类型，分别是：</p>
<ul>
<li>Boolean 布尔</li>
<li>String 字符串</li>
<li>Number 数字</li>
<li>Null</li>
<li>Undefined</li>
<li>对象</li>
</ul>
<p>其中，是分为 <code>基本类型</code> 和 <code>引用类型</code>。<br>Boolean、String、Number、Null、Undefined都是基本类型。基本类型是按值访问的，意思是说，操作的是保存在变量中的实际值。</p>
<p>引用类型的值是保存在内存中的对象。因为JavaScript不允许直接操作对象的内存空间，所以，在操作对象的时候，实际上是操作对象的引用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> another_num = num; <span class="comment">// 都是10</span></span><br><span class="line"></span><br><span class="line">another_num++; <span class="comment">// anther_num的值是11</span></span><br><span class="line"><span class="built_in">console</span>.log(another_num); <span class="comment">// 11</span></span><br><span class="line"><span class="built_in">console</span>.log(num); <span class="comment">// 而num的值还是10</span></span><br></pre></td></tr></table></figure>
<p>引用对象表现的是这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> example = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> another_example = example;</span><br><span class="line"></span><br><span class="line">another_example.push(<span class="number">6</span>); <span class="comment">// 向another_example尾部压入一个数字</span></span><br><span class="line"><span class="built_in">console</span>.log(another_example); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="built_in">console</span>.log(example); <span class="comment">// [1, 2, 3, 4, 5, 6] 输出example发现，example也改变了。</span></span><br></pre></td></tr></table></figure></p>
<p>对于对象的操作也是如此。</p>
<p>因此，新手常犯的一个错误就是，把一个数组或者对象 <code>复制</code> 给了另外一个。这样就可以对 <code>复制</code> 出来的新对象随便操作了。<br>实际上，赋值语句传递的实际上是引用。</p>
<p>那么复制一个数组通常可以有两个方法。<br>一个是用ECMAScript5规定给数组的 <code>concat()</code>来返回一个复制的数组。<br><code>concat()</code> 本身是用来将里面的参数加入到数组的尾部。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">b = a.concat(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<p>在这里还有一点要说明，在JavaScript中，基本类型是不可以直接 <code>操作</code> 的，恩，没有看错。<br>看代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line">a = a + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>上面的代码先是声明变量 <code>a</code> ，然后给变量 <code>a</code> 赋值为1，最后一个操作实际上是 先计算 <code>a + 1</code> 的值，然后生成新的值，再将新的值赋值给 <code>a</code>。</p>
<p>回到正题上来。<br>赋值数组还有一个方法直接的方法。使用 <code>slice()</code> 。<br><code>slice</code> 方法据说是JavaScript中，比较神奇的方法，它可以接受两个参数。</p>
<ul>
<li>第一个参数是从哪里开始。</li>
<li>返回从第一个参数到第二个参数之间的项，不包括第二个参数。注意，第二个参数是可选的，如果没有提供第二个参数，那么会返回从第一个参数到数组尾部的所有值。<br>举个栗子：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LiZi = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(LiZi.slice(<span class="number">0</span>,<span class="number">4</span>));   <span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"><span class="built_in">console</span>.log(LiZi.slice(<span class="number">1</span>,<span class="number">4</span>));   <span class="comment">// [2, 3, 4]</span></span><br><span class="line"><span class="built_in">console</span>.log(LiZi.slice(<span class="number">2</span>,<span class="number">4</span>));   <span class="comment">// [3, 4]</span></span><br><span class="line"><span class="built_in">console</span>.log(LiZi.slice(<span class="number">2</span>,-<span class="number">1</span>));  <span class="comment">// [3, 4, 5]</span></span><br><span class="line"><span class="built_in">console</span>.log(LiZi.slice(<span class="number">0</span>));     <span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>上面的 <code>LiZi.slice(2,-1)</code> 意思是从第三个元素开始一直到结尾，等价于 <code>LiZi.slice(2)</code> 。<br>所以，复制整个数组可以直接 <code>LiZi.slice(0)</code> ，它将会返回从开始到结尾的全部值。<br>在这里需要明白一点，不论是 <code>concat</code> 还是 <code>slice</code> 都不会直接对数组进行操作。<br>它们都是返回操作之后的内容。</p>
<p>当然，对于数组的复制，还有别的方法，比如遍历整个数组。<br>不过，我觉得，用ECMAScript5提供的方法会更快，因为这是JavaScript的实现（浏览器或者Nodejs）来完成的，更直接，效率上更快。</p>
<p>下一篇会介绍JavaScript对象的复制。</p>
<p>欢迎拍砖。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript-对象-复制/">JavaScript 对象 复制</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-安装hexo需要注意的一些坑" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/03/26/安装hexo需要注意的一些坑/" class="article-date">
  	<time datetime="2015-03-25T18:02:19.000Z" itemprop="datePublished">2015-03-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/26/安装hexo需要注意的一些坑/">安装hexo需要注意的一些坑</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前言：</p>
<pre><code>因为电脑系统问题，整个盘格式化了，之前配置的hexo都忘记上传到网盘上。
现在放在百度云盘的目录下，会自动上传。
但是，部署hexo的时候，要关掉百度上传，不然会出现文件读取错误。
这里的所有坑都在windows平台下，linux下的同学可以先去外边玩耍了。
</code></pre><h1 id="前期准备的坑">前期准备的坑</h1><pre><code>为了能够使用hexo，需要先安装 nodejs , <span class="built_in">npm</span> ， hexo , git 。
</code></pre><h2 id="安装nodejs">安装nodejs</h2><p>截止现在nodejs版本为0.12.1，其中中间版本12(偶数)代表是稳定版，1是小版本号。</p>
<p>安装nodejs只需要到官网上下载msi安装包即可，自动安装，自动写入PATH环境变量，很便利有木有~</p>
<p>这时，请按下 <code>开始按钮 + r</code> ，出现运行窗口，在里面输入 <code>powershell</code> ，然后回车出现蓝底的命令行界面。</p>
<p>在里面输入 <code>node -v</code> ，将会返回 <code>v0.12.1</code> ，这是我安装在电脑中nodejs目前的版本号。</p>
<p>如果你很快就到了这一步，那么恭喜你，你运气不错，因为到这里才开始有坑出现。</p>
<p>客官请看下面。</p>
<h2 id="npm">npm</h2><p>先有个好消息要告诉你：安装nodejs的时候，npm会自动帮你装好，并且也已经写入到系统的环境变量（写入环境变量是为了可以在命令行中调用）当中。</p>
<p>同样，和上面一样，你也可以在powershell中输入 <code>npm -v</code>，将会显示npm的版本号。</p>
<p>当然，有好消息也会有坏消息。</p>
<h2 id="Hexo">Hexo</h2><p>终于来到了今天的主题，Hexo.</p>
<p>要安装Hexo，比较推荐的一个做法是使用 <code>npm</code> 或者 <code>cnpm</code> 来安装，命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g&#10;&#10;// &#25110;&#32773;&#10;cnpm install hexo -g</span><br></pre></td></tr></table></figure></p>
<p>这里的 <code>-g</code> 是指定为全局，全局安装之后，在任何地方都可以调用，如果不加入 <code>-g</code> 的话，包会被下载到在当前目录下，只可以被当前目录以内的程序访问。具体可以去了解nodejs中 <code>require</code> 的行为。</p>
<p>通常用npm安装包都会比较慢，因为npm的服务器在地球的另一边米国。数据传输需要通过海底电缆，因此速度非常慢，像我这样本命年运气不好的在请求的时候直接就超时了。</p>
<p>在使用npm安装包的时候，可以指定远程仓库的地址（默认在米国的那个）。在这种时候，我们可以为此次下载包指定一个远程仓库。</p>
<p>在国内淘宝架设了一个 <a href="https://npm.taobao.org" target="_blank" rel="external">地址</a>。</p>
<p>在官网上的命令步骤是：<br>打开 <code>cmd</code> 或者 <code>powershell</code>，切换到你想建立文件夹的地方。使用下面的命令，就会在当前目录下，建立一个 <code>blog</code> 命名的目录，这个目录下面在初始化的时候，会已经存在一些文件。<br>其中就包括 <code>package.json</code> 这个文件，在这个目录下执行 <code>npm install</code> 或者 <code>npm i</code> 的时候，<code>npm</code> 会自动寻找当前目录下的 <code>package.json</code> 文件，然后读取里面的依赖信息向远程仓库请求需要下载模块。<br>具体命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog //(&#21517;&#23383;&#38543;&#24847;)&#10;cd blog&#10;npm install</span><br></pre></td></tr></table></figure></p>
<p>然而，由于npm默认设置的仓库在米国，路途遥远，中间又有很多劫道的，在下载包的时候经常会超时或者出错。</p>
<p>在这个时候，可以在执行 <code>npm install</code> 或者 <code>npm i</code> 命令的时候，为其指定一个远程仓库。命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<p>当然，也可以这样写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<p>npm的安装命令，后面有 <code>install</code> | <code>i</code> 的时候，后面如果没有指定包的名字，那么会自动读取目录下的 <code>pachage.json</code> 文件来获取依赖信息，如果该目录下没有 <code>package.json</code> 文件，那么就会提示 <code>Couldn&#39;t read dependencies</code> 。</p>
<p>每次都指定这个地址多麻烦，所以也可以直接安装 <code>npm</code> 的中国兄弟 <code>cnpm</code> ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<p>这东西和 <code>npm</code> 基本差不多，所以安装好之后，以后依赖包的安装都可以直接使用 <code>cnpm</code> 命令来代替。</p>
<p>淘宝的npm仓库只是镜像，它每天会和远在米国的npm总库同步，因此，也会有一个新包在cnpm上找不到的情况，或者版本落后于最新版本的情况发生。</p>
<h1 id="配置">配置</h1><h2 id="_config-yml">_config.yml</h2><p>配置 <code>_config.yml</code> 文件，只要记住一件事：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Site&#10;title:&#27815;&#28010; //&#38169;&#35823;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Site&#10;title: &#27815;&#28010; //&#27491;&#30830;</span><br></pre></td></tr></table></figure>
<p>两者之间的唯一区别就是分好后面需要一个空格。<br>so，出现问题请先检查空格问题。</p>
<p>另外一个小坑是，大部分人使用Hexo的时候，都是为了放在 github 上面，所以，在配置 <code>_config.yml</code> 时候，有一项：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Deployment&#10;## Docs: http://hexo.io/docs/deployment.html&#10;deploy:&#10;  type: git // &#27880;&#24847;&#36825;&#37324; &#65292; &#24517;&#39035;&#20889;git&#65292;&#19981;&#21487;&#20197;&#20889;github&#65292;&#22240;&#20026;&#36825;&#37324;&#25351;&#30340;&#26041;&#24335;&#12290;&#10;  repo: git@github.com:sinoon/sinoon.github.io.git</span><br></pre></td></tr></table></figure></p>
<p>有些人辛辛苦苦的配置了密钥，但是在使用 <code>hexo d</code> 部署的时候，还是需要输入账号密码，原因在于使用了 <code>http</code> 协议。<br>其实就是说，上面的 <code>repo</code> 里面，要像我一样使用 <code>git</code> 协议。</p>
<h2 id="发布">发布</h2><p>有些人不喜欢看doc文档，在部署的时候会提示 <code>ERROR Deployer not found:</code> ，原因可能如上面所说。</p>
<p>但是即使按照上面配置了也是会有问题的，原因在于需要安装一个 <code>hexo</code> 控件。命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p>
<p>到了这一步，基本安装就完成了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 sinoon
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>